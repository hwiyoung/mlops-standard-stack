# 🚀 MLOps 통합 대시보드 실행 매뉴얼

본 문서는 대시보드를 통해 **위성 영상 변화탐지(CD)** 및 **3D Novel View Synthesis(NVS)**를 수행하는 전체 과정을 스텝 바이 스텝으로 가이드합니다.

---

## 0. 시작하기 전에: 접속 및 네트워크 설정

1.  **접속**: 브라우저에서 대시보드 주소([http://192.168.10.203:8501](http://192.168.10.203:8501))에 접속합니다.
2.  **서버 IP 확인**: 사이드바 하단의 **[🌐 네트워크 설정]**에서 현재 접속한 IP가 올바르게 표시되는지 확인합니다. (외부 접속 시 필수)
3.  **서비스 상태**: `🔌 서비스 상태` 섹션에서 MinIO와 MLflow가 ✅ 상태인지 확인합니다.

---

## 📂 프로세스 1: 위성 영상 변화탐지 (Change Detection)

### 스텝 1: 데이터 업로드
- **Data Manager** 탭으로 이동합니다.
- **📁 로컬 폴더 선택**: `/workspace/data/` 하위의 폴더를 드롭다운에서 선택합니다. (오타 방지)
- **데이터 구조**:
    - `pre/`, `post/`, `mask/`: 변화탐지용
    - `images/`: NVS(3DGS) 학습용
    - `*.tif`: 정사영상(GeoTIFF)
- **조작**: 대상 버킷과 저장 경로(prefix)를 선택하고 `🚀 업로드 실행`을 클릭합니다.

### 스텝 2: 모델 학습
- **Training Lab** 탭에서 `Change Detection` 선택.
- **📁 데이터 경로 설정**: 업로드한 프로젝트 폴더를 선택합니다.
- **🧠 파라미터**: Epochs(기본 50), Batch Size(기본 8) 등을 조절합니다.
- **실행**: `🚀 학습 시작` 클릭. 실시간 로그에서 IoU 수치가 올라가는지 확인합니다.

### 스텝 3: 실험 분석
- **Model Registry** 탭에서 최신 실험 리스트를 확인합니다.
- 성능(IoU)이 가장 좋은 실험의 **Full Run ID**를 확인하거나 상세 페이지로 이동합니다.

### 스텝 4: 추론 및 시각화
- **Inference** 탭에서 `Change Detection` 선택.
- **모델 로드**: MLflow Run ID를 선택하거나 체크포인트 경로를 입력합니다.
- **이미지 업로드**: 분석할 새로운 Pre/Post 위성 영상을 업로드하고 `🔮 추론 실행`을 클릭합니다.
- **결과**: 생성된 오버레이 지도를 확인하고 필요시 다운로드 링크를 생성합니다.

---

## 🎬 프로세스 2: 3D Novel View Synthesis (3DGS)

### 스텝 1: 데이터 업로드
- **데이터 구조 (COLMAP)**:
    - `images/`: 다각도 사진들
    - `sparse/0/`: 카메라 파라미터 (.bin 파일들)
- **조작**: **Data Manager**에서 `raw-data-nvs` 버킷을 선택하여 프로젝트 폴더 전체를 업로드합니다.

### 스텝 2: 3D 모델 학습 (Training)
- **Training Lab**에서 `Novel View Synthesis (3DGS)` 선택.
- **📁 데이터 경로 설정**: 업로드된 소스 폴더를 선택합니다.
- **🧠 파라미터**: Iterations(기본 30,000)를 설정합니다. (빠른 확인은 7,000 권장)
- **실행**: `🚀 학습 시작` 클릭. 3D 가우시안들이 최적화되는 로그를 확인합니다.

### 스텝 3: 가상 뷰 렌더링 (Rendering)
- **Inference** 탭에서 `Novel View Synthesis` 선택.
- **모델 로드**: 학습 완료된 특정 Run을 리스트에서 선택합니다.
- **렌더링 설정**: 프레임 수(길이), 해상도(720p 등)를 지정합니다.
- **실행**: `🎬 렌더링 실행` 클릭. (서버 사양에 따라 수 분 소요)

---

## 📍 프로세스 3: 지도 기반 데이터 관리 (Map Browser)

업로드된 데이터를 지도 위에서 직관적으로 관리하고 확인합니다.

### 스텝 1: 데이터 인덱싱 (Indexing)
- **지도 브라우저** 탭 우측의 `⚙️ 인덱싱 (Indexing)` 섹션을 엽니다.
- `🪣 대상 버킷`과 `📂 경로`를 입력하고 `📥 인덱싱 실행`을 클릭합니다.
- 인덱서가 GPS 정보를 추출하여 지도 위에 마커를 생성합니다. (업로드 후 자동 실행 기능 포함)

### 스텝 2: 위치 및 영역 확인
- **📍 파란색 마커**: 단일 사진(JPEG/PNG)의 촬영 지점입니다.
- **🔲 하늘색 폴리곤**: 정사영상(GeoTIFF)이 덮고 있는 실제 지리적 영역입니다.
- **자동 줌**: 필터링된 데이터가 한눈에 들어오도록 지도가 자동으로 위치를 잡습니다.

### 스텝 3: 데이터 프리뷰 및 다운로드
- 지도 위의 마커나 폴리곤을 클릭합니다.
- **팝업**: 썸네일 이미지와 파일명, 용량, 해상도 정보를 확인합니다.
- **원본 확인**: 썸네일을 클릭하면 새 창에서 원본 이미지가 열립니다. (정사영상은 다운로드 링크 제공)

### 스텝 4: 정밀 필터링
- 우측 **🔍 필터** 패널에서 버킷, 폴더 경로(드롭다운), 데이터 유형별로 원하는 검색 결과만 지도에 남길 수 있습니다.

---

## 💡 주요 팁

- **임시 다운로드**: **Data Manager** 하단에서 파일 목록을 선택하면 누구에게나 공유 가능한 **7일 유효 보안 링크**를 만들 수 있습니다.
- **Config 오버라이드**: 대시보드 설정값은 YAML 파일보다 우선순위가 높습니다. 더 세밀한 조정은 `configs/` 경로의 YAML 파일을 직접 편집하세요.
- **문제 해결**: 만약 MLflow UI가 열리지 않는다면 사이드바의 `서버 IP`를 현재 본인이 접속한 주소로 다시 입력해 보세요.

---

## 📦 대용량 데이터 업로드 (MinIO CLI)

대시보드를 통한 업로드는 소규모에 적합합니다. **수십 GB 이상**의 정사영상이나 수천 장의 드론 사진은 **MinIO CLI (mc)**를 사용하세요.

### 1. mc 설치 및 설정
```bash
# 자동 설치 스크립트 실행
./scripts/setup_minio_cli.sh
```

### 2. 기본 명령어
```bash
# 버킷 목록 확인
mc ls myminio

# 폴더 전체 업로드 (미러링)
mc mirror ./local_data/ myminio/raw-data/project_name/

# 중단된 업로드 이어서 진행 (자동으로 Resume됨)
mc mirror ./local_data/ myminio/raw-data/project_name/

# 파일 다운로드
mc cp myminio/raw-data/output.tif ./local/
```

### 3. 장점
- **Multipart Upload**: 대용량 파일을 자동으로 청크 분할.
- **Resume 지원**: 네트워크 끊김 시 `--continue` 옵션으로 재개.
- **동기화**: `--watch` 옵션으로 실시간 변경 감지 및 동기화.
